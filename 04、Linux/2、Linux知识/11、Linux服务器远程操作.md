[TOC]

# 通过主机名查看IP

> 返回的结果中有该域名的IP地址

```shell
[root@Demo01 ~]# host www.baidu.com
```



# 远程拷贝

## 本机拷贝到远程服务器

> 要求：必须知道对方的账户和密码，且具备相应的权限。
>
> 语法：`scp [-r] [path]/fie|dir {UserName}@Host_IP:/[path]`
>
> - `-r`：该选项用于传输==文件夹==的时候使用。

1. 案例：将本机的文件拷贝到远程服务器上

   > 注意：如果是第一次访问该服务器，那么会询问，是否要继续连接。每次访问都需要输入远程服务器的密码。
   >
   > 将本机下`/root/install.log` 拷贝到远程主机`192.168.72.129`的root账户下的`/home`目录下

   ```shell
   [root@Demo01 ~]# scp /root/install.log root@192.168.72.129:/home
   ```



## 远程主机拷贝数据到本机

> 要求：必须知道对方的账户和密码，且具备相应的权限。
>
> 语法：`scp {UserName}@Host_IP:/[path]/file /[path]`

1. 案例：将远程服务器中/`home`目录下的`install.log`拷贝到本地的`root`目录下

   ```shell
   [root@Demo01 ~]# scp root@192.168.72.129:/home/install.log /root/
   ```



## 通过主机名进行远程拷贝

1. 修改`/etc/sysconfig/network`将`HOSTNAME`修改为主机名 注：这个修改是永久修改主机名需要重启才能生效

   ```shell
   NETWORKING=yes
   HOSTNAME=Demo01
   ```

2. 临时修改：`hostname 主机名`

3. 想让服务器直到其他服务器的ip以及主机名的对用关系，需要配置`/etc/hosts`文件。将ip地址和主机名做对应即可

   ```shell
   127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
   ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
   
   192.168.72.128 Demo01
   192.168.72.129 Demo02
   ```

   



# 登陆远程服务器

## 需要密码登陆

> 语法：`ssh {UserName}@Host_IP`
>
> 回车之后，如果首次访问，会提示是否继续连接。接下来要求输入远程服务器的密码。

1. 案例：登陆远程主机：192.168.72.129

   > 该主机名：Demo02

   ```shell
   [root@Demo01 ~]# ssh root@192.168.72.128
   ```

   

2. 案例：退出登陆

   > 本机名：Demo01
   >
   > 远程主机名：Demo02

   ```shell
   [root@Demo02 ~]# exit
   [root@Demo01 ~]#
   ```

> Linux系统下，ssh服务的默认端口是22。如果在访问是没有指明端口，默认按照22端口访问，如果远程服务器，提供的端口不是22，那么就需要在访问的时候指定远程服务器的端口：
>
> 语法：`ssh [-p port] {UserName}@Host_IP`





## SSH免密登陆

> Linux免密登录使用的RSA算法。
>
> RSA本身是一种非对称加密算法，会生成公钥和私钥。
>
> - 公钥：使用公钥对内容进行加密
> - 私钥：持有私钥的PC才能正常访问公钥加密的内容
>
> 只要持有私钥就能访问公钥加密的内容，这种事情本身就是存在风险的。一旦私钥丢失，那么服务器上的数据就存在被窃取的风险。但是Linux生成公钥和私钥的时候==支持==对私钥证书文件添加密码。

### 证书的生成

1. 语法：`ssh-keygen`

2. 回车后会有提示：

   - 第一次提示：你的证书存放的位置
   - 第二次提示：对私钥加密，输入密码。如果不需要输入密码，直接回车
   - 第三次提示：私钥证书的密码确认操作

3. 证书文件会存放在当前账户的家目录下的隐藏目录：`.ssh`目录下，在该目录下会有一下4个文件

   | 文件            | 作用                         | 解释                                                         |
   | --------------- | ---------------------------- | ------------------------------------------------------------ |
   | id_rsa          | 私钥                         | 执行证书生成命令才会有                                       |
   | id_rsa.pub      | 公钥                         | 执行证书生成命令才会有                                       |
   | known_hosts     | 曾经访问过的服务器信息       | 每次ssh、scp、ssh-copy-id到远程服务器时就会保存记录到此文件中，以后再此访问该服务器时就不会再提示那一句"你确定要继续访问吗  yes/NO？" |
   | authorized_keys | 记录来访服务器的公钥文件内容 | 该文件会记录访问本机的远程服务器的公钥证书文件内容，只有对应的私钥才能进行验证。 |

### 证书的注册

> 将本机的公钥证书文件注册到远程服务器上，此后就可以使用私钥证书进行登录。

1. 语法：`ssh-copy-id {UserName}@Host_IP`

   > 执行此命令，会要求输入远程服务器的对应账号和密码
   >
   > 这一步就是向远程服务器注册本机的`id_rsa.pub`文件(==公钥==)内容。此后只有本机上与公钥文件共同生成的私钥才能够进行免密登录。（远程主机的公钥名为：`authorized_keys` ）

2. 图解：

   ![](https://gitee.com/sxhDrk/images/raw/master/imgs/证书注册图解.png)



### 证书使用的场景

1. 场景一：只是单纯的使用证书来登录服务器。

   > 使用证书的登录方式可以避免密码遗忘、泄漏的问题。
   >
   > 使用证书登录服务器的方式也是服务器加固(服务器安全相关问题)的方式。
   >
   > 服务器可以设置不允许使用密码进行远程登录。只允许证书的方式登录。
   >
   > 证书本身支持加密，就算证书丢失，再不知道证书密码的情况，证书属于无效文件。

2. 场景二：集群中使用证书进行免密登录。

   > 因为但凡设计到集群的时候，一般都不会是小数目的服务器数量。众多的服务器之间进行互相访问，频繁的输入密码的事情将会成为开发工程师噩梦。
   >
   > 所以，使用证书管理集群的时候，可以免除集群中的服务器互相访问时工程师手工输入密码的问题。



## 双向免密登陆

1. 方法一：

   - 在本机生成密钥和公钥，将公钥注册到包括自己的所有远程服务器中
   - 将私钥注册到其他远程服务器中

2. 方法二：

   - 在每一台服务器中生成公钥和私钥，并且把公钥注册到其他每一台服务器中

   