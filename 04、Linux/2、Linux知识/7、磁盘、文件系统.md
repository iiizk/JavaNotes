[TOC]

# 磁盘

<img src="https://gitee.com/sxhDrk/images/raw/master/imgs/磁盘扇区.png" style="zoom:50%;" /> <img src="https://gitee.com/sxhDrk/images/raw/master/imgs/磁盘.png" alt="image-20200110204051043" style="zoom:50%;" />

> 磁盘，它是由一个个盘片组成的，从盘片的结构上来看 图中的一圈圈灰色同心圆为一条条磁道，从圆心向外画直线     ，可以将磁道划分为若干个弧段，每个磁道上一个弧段被称为一个扇区（图中绿色部分）。扇区是磁盘的最小组成单 元，常是512字节。
>
> - 磁盘分区：指定分割区域起始与结束磁柱 
> - 磁盘存取的区域 例如A磁柱到B磁柱之间的区块，磁盘在此分割区域内操作系统能够知道它可以在指定区块进行文件读，写，查询等操作
> - 但是需要注意使用硬盘之前需要格式化！
> - 因为每种操作系统所设定的文件属性/权限，以及存放数据的格式 有所不同



## Ext2/Ext3/Ext4区别

1. Ext*、NTFS和FAT32这三个都是文件系统格式

2. Linux kernel自2.6.28开始正式支持新的文件系统Ext4 

3. Ext4是Ext3的改进版，修改了Ext3中部分重要的数据结构

4. Ext3对Ext2，只是增加了一个日志功能

5. Ext4可以提供更佳的性能和可靠性，还有更为丰富的功能，更大的文件系统和更大的文件。 

6. - 较之Ext3所支持的最大16TB文件系统和最大2TB文件，Ext4分别 支持1EB（1,048,576TB，1EB=1024PB，1PB=1024TB）的文件系统，以及16TB的文件。 

## 无限数量的子目录

Ext3只支持32,000个子目录，而Ext4支持理论值的无限数量的子目录

### 延迟分配

- Ext3的数据块分配策略是尽快分配，而Ext4是尽可能地延迟分配，直 到文件在cache中写完才开始分配数据块并写入磁盘。 
- 如此能优化整个文件的数据块分配，显著提升性能。 

### 快速fsck（文件系统检查）

- 老的fsck会很慢，因为它要检查所有的索引节点(inode) 
- Ext4给每个组的索引节点表中添加了一份未使用inode的列表，执行fsck就可以跳过它们而只去检查那些在用的索引

### 持久预分配（Persistentpreallocation）

常常会预先创建 一个与所下载文件大小相同的空文件，以免未来的数小时或数天 之内磁盘空间不足导致下载失败。Ext4在文件系统层面实现了持久预分配并提供相应的API，比应用软件自己实现更有效率。 





# SWAP（交换分区）概述

> - 使用磁盘来存储内存不够而“溢出来”的内容(拿硬盘空间来存储内存“溢出”的数据）。
> - 当系统的物理内存不够用的时候，就需要将物理内存中的一部分 空间释放出来，以供当前运行的程序使用。 
> - 最容易成为被释放的对象：一些很长时间没有什么操作的程序。 被 保存到Swap空间中。等到那些被换出的程序要继续运行时，再从Swap中恢复保存的数据到内存中。 
> - 一般来说可以按照如下规则设置swap大小： 
>   - 8G以内的物理内存，SWAP 设置为内存的2倍。 
>   - 8G-16G以内的的物理内存，SWAP 等于内存大小或者设置为8G。 
>   - 16G-256G 的物理内存，SWAP 设置为实际内存的1/2即可。

## 系统什么时候会使用`swap`？

- 实际上，并不是等所有的物理内存都消耗完毕之后，才去使用 swap的空间，什么时候使用是由swappiness 参数值控制。
- `[root@localhost ~]# cat /proc/sys/vm/swappiness` ——> 60
  - 默认值是60。`swappiness=0`的时候表示最大限度使用物理内存 ，然后才是 swap空间，`swappiness＝100`的时候表示积极的使 用swap分区，并且把内存上的数据及时的搬运到swap空间里面。 

## 修改swap参数

1. 临时修改

   ```shell
   [root@localhost ~]# sysctl vm.swappiness=10 
   
   [root@localhost ~]# cat /proc/sys/vm/swappiness 
   10 
   ```

   

2. 永久修改

   >  在`/etc/sysctl.conf` 文件里添加如下参数： `vm.swappiness=10` 

   

   